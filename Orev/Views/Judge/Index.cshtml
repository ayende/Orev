@model Orev.Models.Topic

@{
    ViewBag.Title = "Index";
}

<h2>Judgment</h2>

<p>@Html.ValidationSummary()</p>

<div id="judgingContainer">
<input type="button" id="relevantBtn" value="Yes, it is relevant" />
<input type="button" id="irrelevantBtn" value="No, it is off topic" />

<div>
<iframe name="documentViewer" id="documentViewer" src=""></iframe>
</div>

</div>

    <script type="text/javascript" language="javascript">
        var corpusId = '@ViewBag.CorpusId';
        //var corpusBaseUrl = '@ViewBag.CorpusUrl';
        var topicId = '@ViewBag.TopicId';
        var currentDocumentId = '';
        
        function handleResponse(result)
        {
            if (result.corpusDone)
            {
                $('#documentViewer').attr("src","");
                $('#judgingContainer').hide();
                alert("done with this corpus");
            }
            else
            {
                currentDocumentId = result.nextDoc;
                $('#documentViewer').attr("src", corpusBaseUrl + currentDocumentId);
            }
        }
    
        function saveJudgment(docId, jdgmnt) {
            $.ajax({
                type: "POST",
                url: "/Judge/SaveJudgment",
                data: { 'topicId': topicId, 'corpusId': corpusId, 'docId': docId, 'judgment': jdgmnt },
                dataType: "json",
                async: true,
                cache: false,
                success: function(jsonData) {
                    handleResponse(jsonData);
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("Error while trying to save judgment: " + textStatus);
                }
            });
        }

        $(document).ready(function () {
            saveJudgment('', false);
            
            $("#relevantBtn").click(function(e) {
                saveJudgment(currentDocumentId, true);
            });
            
            $("#irrelevantBtn").click(function(e) {
                saveJudgment(currentDocumentId, false);
            });
            
        });
    </script>
